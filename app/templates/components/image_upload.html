<!-- Image Upload Component -->
<div class="image-upload-section mb-4">
    <div class="image-upload-area" id="{{ id }}_dropArea">
        <input type="file" class="file-input" id="{{ id }}" accept="image/*">
        <div class="upload-content" id="{{ id }}_content">
            <i class="fas fa-cloud-upload-alt upload-icon"></i>
            <div class="upload-text">
                <span class="primary-text">Drag and drop an image here</span>
                <span class="secondary-text">or click to browse</span>
            </div>
        </div>
        <div id="{{ id }}_preview" class="image-preview"></div>
    </div>
</div>

<style>
.image-upload-section {
    width: 100%;
}

.image-upload-area {
    border: 2px dashed #ddd;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    position: relative;
    background-color: #f8f9fa;
    transition: all 0.3s ease;
}

.image-upload-area.drag-over {
    border-color: #0d6efd;
    background-color: #e7f1ff;
}

.file-input {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    opacity: 0;
    cursor: pointer;
}

.upload-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 200px;
}

.upload-icon {
    font-size: 48px;
    color: #6c757d;
    margin-bottom: 16px;
}

.upload-text {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.primary-text {
    font-size: 1.1rem;
    font-weight: 500;
    color: #212529;
}

.secondary-text {
    font-size: 0.9rem;
    color: #6c757d;
}

.image-preview {
    display: none;
    margin-top: 16px;
}

.image-preview img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 4px;
}

.btn-remove {
    position: absolute;
    top: 8px;
    right: 8px;
    background-color: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-remove:hover {
    background-color: rgba(255, 255, 255, 1);
    transform: scale(1.1);
}
</style>

<script>
// Define clearImage function in the global scope
window.clearImage = function(id) {
    const fileInput = document.getElementById(id);
    const preview = document.getElementById(`${id}_preview`);
    const uploadContent = document.getElementById(`${id}_content`);
    
    if (fileInput && preview && uploadContent) {
        fileInput.value = '';
        preview.innerHTML = '';
        preview.style.display = 'none';
        uploadContent.style.display = 'flex';
    }
};

function initImageUpload(id) {
    const dropArea = document.getElementById(`${id}_dropArea`);
    const fileInput = document.getElementById(id);
    const preview = document.getElementById(`${id}_preview`);
    const uploadContent = document.getElementById(`${id}_content`);
    let dragCounter = 0;
    let currentImage = null;

    // Drag and drop handlers
    dropArea.addEventListener('dragenter', handleDragEnter);
    dropArea.addEventListener('dragleave', handleDragLeave);
    dropArea.addEventListener('dragover', handleDragOver);
    dropArea.addEventListener('drop', handleDrop);

    // Image input change handler
    fileInput.addEventListener('change', handleImageSelect);

    function handleDragEnter(e) {
        e.preventDefault();
        dragCounter++;
        dropArea.classList.add('drag-over');
    }

    function handleDragLeave(e) {
        e.preventDefault();
        dragCounter--;
        if (dragCounter === 0) {
            dropArea.classList.remove('drag-over');
        }
    }

    function handleDragOver(e) {
        e.preventDefault();
    }

    function handleDrop(e) {
        e.preventDefault();
        dragCounter = 0;
        dropArea.classList.remove('drag-over');
        
        const files = e.dataTransfer.files;
        if (files.length > 0 && files[0].type.startsWith('image/')) {
            fileInput.files = files;
            handleImageSelect({ target: { files: files } });
        }
    }

    function handleImageSelect(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `
                    <div class="preview-content">
                        <img src="${e.target.result}" alt="Preview">
                        <button type="button" class="btn btn-icon btn-remove" onclick="clearImage('${id}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                uploadContent.style.display = 'none';
                preview.style.display = 'block';
                currentImage = file;
            };
            reader.readAsDataURL(file);
        }
    }

    return {
        getCurrentImage: () => currentImage,
        clearImage: () => clearImage(id)
    };
}
</script> 